#!/bin/sh

# Commit message format validation
commit_msg=$(cat "$1")

# Allow merge commits to bypass format validation
if echo "$commit_msg" | grep -q "^Merge"; then
  exit 0
fi

commit_regex='^\[TL-[0-9]+\]: (Fix|Feat|Chore|Docs|Style|Refactor|Test|Build|CI)\([^)]+\): .+'

if ! echo "$commit_msg" | grep -qE "$commit_regex"; then
  echo "❌ Invalid commit message format!"
  echo ""
  echo "Expected format: [TL-<ticket>]: Type(Scope): Description"
  echo "Allowed types: Fix, Feat, Chore, Docs, Style, Refactor, Test, Build, CI"
  echo ""
  echo "Examples:"
  echo "✅ [TL-123]: Feat(Auth): Implement login flow"
  echo "✅ [TL-456]: Fix(Dashboard): Resolve rendering issue"
  echo "✅ [TL-7]: Chore(Deps): Update dependencies"
  echo ""
  echo "Your message: $commit_msg"
  exit 1
fi
